<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulling Reports with rdfp • rdfp</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Pulling Reports with rdfp">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98603021-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rdfp</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/administrative-tasks.html">Administrative Tasks</a>
    </li>
    <li>
      <a href="../articles/ad-trafficking-setup.html">Ad Trafficking Setup</a>
    </li>
    <li>
      <a href="../articles/manipulating-orders-and-lineitems.html">Manipulating Orders and LineItems</a>
    </li>
    <li>
      <a href="../articles/checking-availability.html">Checking Availability</a>
    </li>
    <li>
      <a href="../articles/pulling-reports.html">Pulling Reports</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/StevenMMortimer/rdfp">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Pulling Reports with rdfp</h1>
                        <h4 class="author">Steven M. Mortimer</h4>
            
            <h4 class="date">2018-03-29</h4>
          </div>

    
    
<div class="contents">
<p>First, we load <code>dplyr</code> and <code>lubridate</code> to use in this vignette along with loading the <code>rdfp</code> package and specifying the DFP network we would like to connect to.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressWarnings</span>(<span class="kw">suppressMessages</span>(<span class="kw">library</span>(dplyr)))
<span class="kw">suppressWarnings</span>(<span class="kw">suppressMessages</span>(<span class="kw">library</span>(lubridate)))
<span class="kw">library</span>(rdfp)
<span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">options</span>(<span class="dt">rdfp.network_code =</span> <span class="dv">123456789</span>)</code></pre></div>
<p>Just a note, that it’s not necessary to setup your own application client_id and client_secret through the Google Developer’s Console. The only difference is that the authentication will be run through the client created and associated with the <code>rdfp</code> package. By using the package client, you will <em>NOT</em> be giving access to your DFP to anyone, the package is just the medium for you to connect to your own data. If you wanted more control you would specify those options like so:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">rdfp.application_name =</span> <span class="st">"MyApp"</span>)
<span class="kw">options</span>(<span class="dt">rdfp.client_id =</span> <span class="st">"012345678901-99thisisatest99.apps.googleusercontent.com"</span>)
<span class="kw">options</span>(<span class="dt">rdfp.client_secret =</span> <span class="st">"Th1s1sMyC1ientS3cr3t"</span>)

<span class="kw"><a href="../reference/dfp_auth.html">dfp_auth</a></span>()</code></pre></div>
<div id="delivery-by-advertiser" class="section level4">
<h4 class="hasAnchor">
<a href="#delivery-by-advertiser" class="anchor"></a>Delivery by Advertiser</h4>
<p>A common request is to check how each line item is delivering for an advertiser. This type of request can be run through a DFP report job. Report jobs have a special flow, but there is a single function (<code>dfp_full_report_wrapper</code>) in the <strong>rdfp</strong> package that will manage that flow and run a requested job for you.</p>
<p>In this example, we specify dimensions including the line, order, advertiser, and ad unit. The <code>'FLAT'</code> ad unit view just ensures that we get tabular data with one row per ad unit in case we’d like to total them up. If you’d like to run multiple reports with slight variations in date or dimensions, it is encouraged that you keep you criteria and use a loop or vectorized function to generate each report since the request data must be formatted as a list in each call.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">report_request_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">reportJob =</span>
                              <span class="kw">list</span>(<span class="dt">reportQuery =</span>
                                     <span class="kw">list</span>(<span class="dt">dimensions =</span> <span class="st">'AD_UNIT_NAME'</span>,
                                          <span class="dt">dimensions =</span> <span class="st">'ADVERTISER_NAME'</span>,
                                          <span class="dt">dimensions =</span> <span class="st">'ORDER_NAME'</span>,
                                          <span class="dt">dimensions =</span> <span class="st">'LINE_ITEM_NAME'</span>,
                                          <span class="dt">adUnitView =</span> <span class="st">'FLAT'</span>,
                                          <span class="dt">columns =</span> <span class="st">'AD_SERVER_IMPRESSIONS'</span>, 
                                          <span class="dt">columns =</span> <span class="st">'AD_SERVER_CLICKS'</span>,
                                          <span class="dt">dateRangeType =</span> <span class="st">'LAST_WEEK'</span>)
                                   )
                            )
delivery_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_full_report_wrapper.html">dfp_full_report_wrapper</a></span>(report_request_data)</code></pre></div>
</div>
<div id="working-with-saved-queries" class="section level4">
<h4 class="hasAnchor">
<a href="#working-with-saved-queries" class="anchor"></a>Working with Saved Queries</h4>
<p>DFP has a feature that allows for saving query criteria. These queries can be pulled back via the API and the criteria submitted back so that you always run the same report each time, or can easily replicate a query that another person has created in the UI.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># look for a particular saved query</span>
this_result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_getSavedQueriesByStatement.html">dfp_getSavedQueriesByStatement</a></span>(<span class="kw">list</span>(<span class="dt">filterStatement=</span><span class="kw">list</span>(<span class="dt">query=</span><span class="st">"WHERE id = 936165016"</span>)), <span class="dt">as_df=</span><span class="ot">FALSE</span>)
this_report_query &lt;-<span class="st"> </span>this_result[[<span class="dv">1</span>]]<span class="op">$</span>reportQuery

<span class="co"># resubmit the report job with the saved query</span>
report_request_data2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">reportJob=</span><span class="kw">list</span>(<span class="dt">reportQuery =</span> this_report_query))
delivery_dat2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_full_report_wrapper.html">dfp_full_report_wrapper</a></span>(report_request_data2)</code></pre></div>
</div>
<div id="a-more-detailed-explanation-of-the-report-process" class="section level4">
<h4 class="hasAnchor">
<a href="#a-more-detailed-explanation-of-the-report-process" class="anchor"></a>A More Detailed Explanation of the Report Process</h4>
<p>Reports actually require 3 steps from the [ReportService] (<a href="https://developers.google.com/doubleclick-publishers/docs/reference/v201802/ReportService" class="uri">https://developers.google.com/doubleclick-publishers/docs/reference/v201802/ReportService</a>): 1) to request the report, 2) check on its status, and 3) download. This basic process flow is required for all reports requested via this service. The wrapper function used above named <code>dfp_full_report_wrapper</code> manages all aspects of reporting, so this level of detail is not needed unless the wrapper service does not quite fit your needs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># create a reportJob object</span>
<span class="co"># reportJobs consist of a reportQuery</span>
<span class="co"># Documentation for the reportQuery object can be found in R using </span>
<span class="co"># ?dfp_ReportService_object_factory and searching for ReportQuery</span>
<span class="co"># Also online documentation is available that lists available child elements for reportQuery</span>
<span class="co"># https://developers.google.com/doubleclick-publishers/docs/reference/v201802/ReportService.ReportQuery</span>
request_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">reportJob=</span><span class="kw">list</span>(<span class="dt">reportQuery=</span><span class="kw">list</span>(<span class="dt">dimensions=</span><span class="st">'MONTH_AND_YEAR'</span>, 
                                                     <span class="dt">dimensions=</span><span class="st">'AD_UNIT_ID'</span>,
                                                     <span class="dt">adUnitView=</span><span class="st">'FLAT'</span>,
                                                     <span class="dt">columns=</span><span class="st">'TOTAL_INVENTORY_LEVEL_IMPRESSIONS'</span>, 
                                                     <span class="dt">startDate=</span><span class="kw">list</span>(<span class="dt">year=</span><span class="dv">2018</span>, <span class="dt">month=</span><span class="dv">10</span>, <span class="dt">day=</span><span class="dv">1</span>),
                                                     <span class="dt">endDate=</span><span class="kw">list</span>(<span class="dt">year=</span><span class="dv">2018</span>, <span class="dt">month=</span><span class="dv">10</span>, <span class="dt">day=</span><span class="dv">31</span>),
                                                     <span class="dt">dateRangeType=</span><span class="st">'CUSTOM_DATE'</span>
                                                     )))

<span class="co"># the result is a list and most importantly the ID is included for checking its status</span>
dfp_runReportJob_result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_runReportJob.html">dfp_runReportJob</a></span>(request_data)
dfp_runReportJob_result<span class="op">$</span>id
dfp_runReportJob_result<span class="op">$</span>reportJobStatus

<span class="co"># to check the status repeatedly you just need to provide the id</span>
<span class="co"># dfp_getReportJobStatus_result returns a character string of the reportJob status</span>
request_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">reportJobId=</span>dfp_runReportJob_result<span class="op">$</span>id)
dfp_getReportJobStatus_result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_getReportJobStatus.html">dfp_getReportJobStatus</a></span>(request_data)
dfp_getReportJobStatus_result

<span class="co"># a simple while loop can keep checking a long running request until ready</span>
counter &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">while</span>(dfp_getReportJobStatus_result<span class="op">!=</span><span class="st">'COMPLETED'</span> <span class="op">&amp;</span><span class="st"> </span>counter <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>){
  dfp_getReportJobStatus_result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_getReportJobStatus.html">dfp_getReportJobStatus</a></span>(request_data)
  <span class="kw">Sys.sleep</span>(<span class="dv">3</span>)
  counter &lt;-<span class="st"> </span>counter <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
}

<span class="co"># once the status is "COMPLETED" the data download URL can be retrieved</span>
request_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">reportJobId=</span>dfp_runReportJob_result<span class="op">$</span>id, <span class="dt">exportFormat=</span><span class="st">'CSV_DUMP'</span>)
dfp_getReportDownloadURL_result &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_getReportDownloadURL.html">dfp_getReportDownloadURL</a></span>(request_data)

<span class="co"># convenience function has been provided to download the data from URL</span>
<span class="co"># and convert to a data.frame</span>
<span class="co"># supported exportFormats are currently c('CSV_DUMP', 'TSV', 'CSV_EXCEL')</span>
report_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dfp_report_url_to_dataframe.html">dfp_report_url_to_dataframe</a></span>(<span class="dt">report_url=</span>dfp_getReportDownloadURL_result, 
                                          <span class="dt">exportFormat=</span><span class="st">'CSV_DUMP'</span>)
<span class="kw">head</span>(report_dat)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Steven M. Mortimer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
